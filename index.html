<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>QCM Culture Incendie – Fin de formation</title>

<style>
:root{
  --ok:#2e7d32;
  --ko:#c62828;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:#0f1115;
  color:#111;
}
.bg{
  position:fixed;
  inset:0;
  background:url("regiolis.jpg") center/cover no-repeat;
  z-index:-3;
}
.overlay{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,rgba(0,0,0,.75),rgba(0,0,0,.55));
  z-index:-2;
}
.container{
  max-width:800px;
  margin:auto;
  padding:20px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  margin-bottom:15px;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}
h1{
  color:#fff;
  text-align:center;
}
label{
  font-weight:700;
  display:block;
  margin-top:12px;
}
input,select,textarea{
  width:100%;
  padding:12px;
  margin-top:5px;
}
button{
  width:100%;
  padding:14px;
  margin-top:15px;
  font-weight:700;
  cursor:pointer;
}
.options label{
  display:flex;
  align-items:center;
  border:1px solid #ddd;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
}
.options input{margin-right:10px}
.danger{color:var(--ko);font-weight:700}
.good{color:var(--ok);font-weight:700}
.bad{color:var(--ko);font-weight:700}
</style>
</head>

<body>
<div class="bg"></div>
<div class="overlay"></div>

<div class="container">
<h1>QCM Culture Incendie</h1>

<!-- ACCÈS FORMATION -->
<div id="startCard" class="card">
<label>Service *</label>
<select id="service">
  <option value="">— Sélectionner —</option>
  <option>Escale</option>
  <option>ASCT</option>
  <option>Vente / Accueil</option>
  <option>Sûreté</option>
  <option>Maintenance / Technique</option>
  <option>Gares & Connexions</option>
</select>

<label>Nom *</label>
<input id="nom">
<label>Prénom *</label>
<input id="prenom">

<label>Code de formation *</label>
<input id="code" placeholder="Code communiqué en fin de formation">

<p id="startError" class="danger" style="display:none">
Tous les champs sont obligatoires et le code doit être valide.
</p>

<button id="startBtn">Démarrer le QCM</button>
</div>

<!-- QUIZ -->
<div id="quizCard" class="card" style="display:none">
<p><strong>Question <span id="qIndex"></span>/12</strong></p>
<div id="question"></div>
<div id="options" class="options"></div>
<button id="nextBtn" disabled>Valider & Suivant</button>
</div>

<!-- ENVOI -->
<div id="sendCard" class="card" style="display:none">
<label>Remarque / retour (optionnel)</label>
<textarea id="commentaire"></textarea>
<button id="sendBtn">Envoyer mes réponses</button>
<p id="sendInfo"></p>
</div>

<!-- CORRECTION -->
<div id="correctionCard" class="card" style="display:none">
<h2>Correction</h2>
<p id="score"></p>
<div id="details"></div>
</div>
</div>

<script>
/* CONFIG */
const CODE_SESSION = "escalebayonne";
const APPS_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbwmsKnIF0TcKtKYAnwg0XetWkUiorxTJuBYW6gw6zbTohBUhvI1b5bJO9ladR-zssG2/exec";

/* QUESTIONS */
const QUESTIONS = [
{q:"Lors du déclenchement d’une alarme incendie en gare, quelle est la première action à réaliser sur la centrale SSI ?",o:["Se rendre immédiatement sur zone","Arrêter le signal sonore pour analyser","Réarmer le système","Appeler les secours"],c:1},
{q:"Quelle information doit être identifiée en priorité sur la centrale SSI ?",o:["Historique des alarmes","Localisation précise (zone / local)","Niveau d’accès","Heure de déclenchement"],c:1},
{q:"Comment identifier visuellement un déclencheur manuel ou détecteur en alarme ?",o:["Voyant vert","Voyant rouge clignotant","Signal sonore","Étiquette"],c:1},
{q:"Lorsqu’un feu est confirmé ou qu’un doute sérieux subsiste, quelle est la conduite prioritaire ?",o:["Réarmer le SSI","Poursuivre la levée de doute","Mettre en sécurité les personnes et alerter","Attendre l’astreinte"],c:2},
{q:"Concernant l’alarme sonore incendie en gare, quelle règle doit être respectée ?",o:["Elle peut être arrêtée dès identification","Elle facilite la levée de doute","Elle reste active jusqu’à fin d’évacuation","Elle s’arrête automatiquement"],c:2},
{q:"Le passage au niveau 2 du SMSI permet principalement :",o:["Déclencher l’évacuation","Accéder aux commandes de gestion","Neutraliser l’alarme","Couper le SDI"],c:1},
{q:"Le rôle principal du SDI est de :",o:["Agir sur le bâtiment","Détecter et signaler un départ de feu","Commander le désenfumage","Gérer l’évacuation"],c:1},
{q:"Qui pilote le désenfumage dans le cadre du SSI ?",o:["L’agent terrain","Le SDI","Le SMSI","Les secours uniquement"],c:2},
{q:"En situation incendie, la priorité absolue du CEV est :",o:["Continuité du service","Protection du matériel","Sécurité des personnes","Remise du SSI"],c:2},
{q:"Lors de l’arrivée des sapeurs-pompiers, le rôle du CEV est :",o:["Diriger les opérations","Intervenir sur le feu","Accueillir et transmettre les informations","Réarmer le système"],c:2},
{q:"Quels sont les numéros d’urgence à utiliser en cas d’incendie ?",o:["17 et 112","18 et 112","15 et 18","112 uniquement"],c:1},
{q:"Quelle information est prioritaire à transmettre aux sapeurs-pompiers ?",o:["Cause supposée","Localisation précise et évolution","Nom du chef d’escale","Impact circulation"],c:1}
];

let idx=0,answers=[];
const $=id=>document.getElementById(id);

/* ACCÈS */
$("startBtn").onclick=()=>{
  if(
    !$("service").value ||
    !$("nom").value ||
    !$("prenom").value ||
    $("code").value !== CODE_SESSION
  ){
    $("startError").style.display="block";
    return;
  }
  $("startError").style.display="none";
  $("startCard").style.display="none";
  $("quizCard").style.display="block";
  render();
};

function render(){
  $("qIndex").textContent = idx+1;
  $("question").textContent = QUESTIONS[idx].q;
  $("options").innerHTML="";
  QUESTIONS[idx].o.forEach((t,i)=>{
    const l=document.createElement("label");
    l.innerHTML=`<input type="radio" name="opt" value="${i}"> ${t}`;
    $("options").appendChild(l);
  });
  $("nextBtn").disabled=true;
  $("options").onchange=()=>$("nextBtn").disabled=false;
}

$("nextBtn").onclick=()=>{
  const sel=[...document.getElementsByName("opt")].find(r=>r.checked);
  answers.push(sel?+sel.value:null);
  idx++;
  if(idx===QUESTIONS.length){
    $("quizCard").style.display="none";
    $("sendCard").style.display="block";
  } else render();
};

/* ENVOI */
$("sendBtn").onclick=async()=>{
  const score = answers.filter((a,i)=>a===QUESTIONS[i].c).length;
  const payload = {
    nom: $("nom").value,
    prenom: $("prenom").value,
    service: $("service").value,
    score: score + "/12",
    details: answers,
    commentaire: $("commentaire").value,
    userAgent: navigator.userAgent
  };

  $("sendInfo").textContent = "Envoi des réponses…";

  try{
    await fetch(APPS_SCRIPT_URL,{
      method:"POST",
      body: JSON.stringify(payload),
      mode:"no-cors"
    });
  }catch(e){}

  showCorrection(score);
};

function showCorrection(score){
  $("sendCard").style.display="none";
  $("correctionCard").style.display="block";
  $("score").innerHTML=`<strong>Score : ${score}/12</strong>`;
  $("details").innerHTML="";
  QUESTIONS.forEach((q,i)=>{
    const ok = answers[i]===q.c;
    const div=document.createElement("div");
    div.innerHTML=`
      <p>
        <strong>Q${i+1}</strong> – ${q.q}<br>
        <span class="${ok?"good":"bad"}">Ta réponse : ${q.o[answers[i]]||"Aucune"}</span><br>
        <span class="good">Bonne réponse : ${q.o[q.c]}</span>
      </p>`;
    $("details").appendChild(div);
  });
}
</script>
</body>
</html>

