<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QCM Culture Incendie - Fin de formation</title>

  <style>
    :root { 
      --card-bg: rgba(255,255,255,0.96); 
      --accent: #111;
      --sncf-blue: #0088ce;
      --border: rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0; min-height: 100vh; color: #111; background: #0f1115;
    }
    .bg {
      position: fixed; inset: 0;
      background-image: url("regiolis.jpg");
      background-size: cover; background-position: center;
      z-index: -3; pointer-events: none;
    }
    .overlay {
      position: fixed; inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.7), rgba(0,0,0,0.5));
      z-index: -2; pointer-events: none;
    }
    .container { max-width: 800px; margin: 0 auto; padding: 20px 15px; position: relative; z-index: 1; }
    h1 { color: #fff; font-size: 1.6rem; text-align: center; margin-bottom: 5px; }
    .muted { color: rgba(255,255,255,0.9); text-align: center; font-size: 0.9rem; margin-bottom: 20px; }
    .card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
    label { font-weight: 700; display: block; margin-bottom: 5px; margin-top: 10px; }
    input[type="text"], select, textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); font-size: 1rem; margin-bottom: 10px; }
    button { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--accent); color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 10px; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    button.secondary { background: #fff; color: #111; border: 1px solid #ccc; }
    .pill { background: #eee; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; }
    #questionText { font-size: 1.25rem; font-weight: 800; line-height: 1.3; margin: 15px 0; }
    .options label { display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; cursor: pointer; }
    .options input { transform: scale(1.3); margin-right: 12px; }
    .danger { color: #d32f2f; font-weight: 700; }
    .ok { color: #2e7d32; font-weight: 700; text-align: center; }
    .mail-btn { background: var(--sncf-blue); margin-top: 15px; text-decoration: none; display: block; text-align: center; padding: 14px; border-radius: 10px; color: white; font-weight: bold; }
  </style>
</head>

<body>
<div class="bg"></div>
<div class="overlay"></div>

<div class="container">
  <h1>QCM Culture Incendie</h1>
  <p class="muted">Fin de formation – SSI Gare de Bayonne (12 questions)</p>

  <div id="startCard" class="card">
    <label>Service d’origine (obligatoire)</label>
    <select id="serviceOrigin">
      <option value="">— Sélectionner —</option>
      <option>Escale</option>
      <option>Vente / Accueil</option>
      <option>ASCT</option>
      <option>Conducteur</option>
      <option>Sûreté</option>
      <option>Maintenance / Technique</option>
      <option>Gares & Connexions</option>
    </select>

    <label>Nom / Prénom (facultatif)</label>
    <input id="lastName" type="text" placeholder="Nom" />
    <input id="firstName" type="text" placeholder="Prénom" />

    <button id="startBtn">Démarrer le QCM</button>
    <p id="startWarn" class="danger" style="display:none;">Veuillez sélectionner votre service.</p>
  </div>

  <div id="quizCard" class="card" style="display:none;">
    <span class="pill">Question <span id="qIndex">1</span>/12</span>
    <div id="questionText"></div>
    <div id="options" class="options"></div>
    <button id="nextBtn" disabled>Valider & Suivant</button>
    <button id="skipBtn" class="secondary">Passer</button>
  </div>

  <div id="finalCard" class="card" style="display:none;">
    <h2>QCM terminé</h2>
    <label>Remarque / retour (optionnel)</label>
    <textarea id="freeText"></textarea>
    <button id="sendBtn">Envoyer mes résultats</button>
    <p id="sendStatus"></p>
    <div id="sendErr"></div>
  </div>

  <div id="doneCard" class="card" style="display:none;">
    <h2 class="ok">Résultats envoyés ✔</h2>
    <p style="text-align:center;">Merci pour ta participation.</p>
  </div>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx0kqt1t0nhy3DVU6iJ4vQT4vDLfv_Gz7Jdoha3Ydx-FZdK8KAhdmQa73A3_VTMPt6xKA/exec";
const MON_EMAIL = "Ludovic.klein2@sncf.fr";

const QUESTIONS = [
 {id:"Q1",text:"Première action lors d’une alarme incendie ?",options:["Aller sur zone","Arrêter le signal sonore SDI","Réarmer","Appeler les pompiers"],correctIndex:1},
 {id:"Q2",text:"Information à lire en priorité sur la centrale ?",options:["Historique","Zonage / localisation","Niveau accès","Date"],correctIndex:1},
 {id:"Q3",text:"Voyant d’un détecteur ou DM en alarme ?",options:["Vert fixe","Rouge clignotant","Orange","Bleu"],correctIndex:1},
 {id:"Q4",text:"En cas de feu avéré :",options:["Réarmer","Attendre","Appliquer procédures d’urgence","Couper élec"],correctIndex:2},
 {id:"Q5",text:"Réarmement DM autorisé si :",options:["Toujours","Fausse alarme confirmée","Avant levée doute","Sur ordre radio"],correctIndex:1},
 {id:"Q6",text:"Niveau 2 SMSI permet :",options:["Évacuation","Neutralisation","Accès réarmement","Coupure SDI"],correctIndex:2},
 {id:"Q7",text:"Rôle du SDI ?",options:["Agir","Détecter","Évacuer","Commander DAS"],correctIndex:1},
 {id:"Q8",text:"Rôle du SMSI ?",options:["Détecter","Informer","Piloter les DAS","Éteindre"],correctIndex:2},
 {id:"Q9",text:"Réarmement complet SSI possible si :",options:["Alarme stoppée","Doute levé","DAS remis en attente","CEV présent"],correctIndex:2},
 {id:"Q10",text:"Priorité du CEV en incendie ?",options:["Matériel","Service","Personnes","Délais"],correctIndex:2},
 {id:"Q11",text:"Mission CEV face aux secours :",options:["Commander","Intervenir","Accueillir et informer","Éteindre"],correctIndex:2},
 {id:"Q12",text:"Levée de doute :",options:["Toujours seul","Avec prise de risque","Sans se mettre en danger","En courant"],correctIndex:2}
];

const $ = id => document.getElementById(id);
let idx = 0, answers = [], resp = {};

function renderQuestion() {
  const q = QUESTIONS[idx];
  $("qIndex").textContent = idx + 1;
  $("questionText").textContent = q.text;
  $("options").innerHTML = "";
  q.options.forEach((o,i)=>{
    const l=document.createElement("label");
    l.innerHTML=`<input type="radio" name="opt" value="${i}"> ${o}`;
    $("options").appendChild(l);
  });
  $("nextBtn").disabled = true;
  $("options").onchange = ()=>$("nextBtn").disabled=false;
}

$("startBtn").onclick=()=>{
  if(!$("serviceOrigin").value){$("startWarn").style.display="block";return;}
  resp.service=$("serviceOrigin").value;
  resp.nom=$("lastName").value+" "+$("firstName").value;
  $("startCard").style.display="none";
  $("quizCard").style.display="block";
  renderQuestion();
};

$("nextBtn").onclick=()=>{
  const sel=[...document.getElementsByName("opt")].find(r=>r.checked);
  answers.push({id:QUESTIONS[idx].id,selected:sel?+sel.value:null,isCorrect:sel && +sel.value===QUESTIONS[idx].correctIndex});
  idx++;
  if(idx>=QUESTIONS.length){
    $("quizCard").style.display="none";
    $("finalCard").style.display="block";
  } else renderQuestion();
};

$("skipBtn").onclick=()=>{answers.push({id:QUESTIONS[idx].id,selected:null,isCorrect:false});$("nextBtn").onclick();};

$("sendBtn").onclick=async()=>{
  const payload={
    service:resp.service,
    nom:resp.nom,
    score:answers.filter(a=>a.isCorrect).length+"/12",
    details:JSON.stringify(answers),
    freeText:$("freeText").value
  };
  try{
    await fetch(APPS_SCRIPT_URL,{method:"POST",mode:"no-cors",body:JSON.stringify(payload)});
    $("finalCard").style.display="none";$("doneCard").style.display="block";
  }catch{
    window.location=`mailto:${MON_EMAIL}?subject=Résultats QCM Incendie&body=${encodeURIComponent(JSON.stringify(payload,null,2))}`;
  }
};
</script>
</body>
</html>

